var BASE_URL="",USER_ID=-1;(function(e,a,s){"use strict"
var r,i=function(a){var s=parseInt(r.user/r.total*100),i=r.avg/r.total*100-s
i=parseInt(i>0?i:0,10),1===a?(e(".bar.bar-danger").width(100-s-i+"%"),e(".bar.bar-warning").width(i+"%"),e(".bar.bar-success").width(s+"%")):(e(".bar.bar-success").width(s+"%"),e(".bar.bar-warning").width(i+"%"),e(".bar.bar-danger").width(100-s-i+"%"))}
a=a[a.length-1]==="/"?a:a+"dashboard/",e.getJSON(a+"getProgress/"+s,function(e){r=e,i()}),e.getJSON(a+"getData/"+s,function(a){var n=function(e){var a,s,r,i,t=e.length,l=""
for(a=0;t>a;a+=1)s=e[a],r=s.children?"grey":s.complete===!0?"green":"red",i=s.children?"<div class='milestones' style='display:none'>\n"+n(s.children)+"</div>":"",l+="<div id='"+s.type+"_"+s.id+"' class='milestone'><div class='circle "+r+" pull-left'></div><div class='pull-left'><div class='name'>"+s.name+"</div><div class='desc'>"+s.desc+"</div></div><div class='clearfix'></div>"+i+"</div>"
return l}
e("#milestones").append(n(a))
var t=function(a,n,t){e.post("",{func:"changeComplete",userId:s,type:a,id:n,completed:t}),r.user+=t,i(t)},l=function(){var a=e(this),s=a.hasClass("circle")?a.parent():a.parent().parent(),r=s.attr("id").replace("module_","").replace("assignment_","").replace("milestone_",""),i=s.attr("id").split("_")[0],n=a.hasClass("circle")?a:e(a.parent().parent().children(".circle")[0])
n.hasClass("green")?(n.removeClass("green"),n.addClass("red"),t(i,r,-1)):n.hasClass("red")?(n.removeClass("red"),n.addClass("green"),t(i,r,1)):e(s.children(".milestones")).toggle("fast")}
e(".circle").on("click",l),e(".name").on("click",l),e(".desc").on("click",l)})})(jQuery,BASE_URL,USER_ID)
